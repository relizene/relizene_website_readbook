{% extends "base.html" %}
{% load static %}
{% load books_tags %}

{% block css %}
    <link rel="stylesheet" href="{% static "css\book\book_read\book-read.css" %}">
    <link rel="stylesheet" href="{% static "css\book\book_read\book-form.css" %}">

{% endblock %}

{% block content %}
<div class="container-fluid pt-0 mt-0">
    <div class="row justify-content-center pt-0 mt-0"> <!-- –î–æ–±–∞–≤–ª–µ–Ω justify-content-center -->
        <!-- –õ–µ–≤–∞—è –ø—É—Å—Ç–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="col-lg-2 col-md-1 d-none d-lg-block pt-0 mt-0"> <!-- –î–æ–±–∞–≤–ª–µ–Ω d-none d-lg-block -->
        </div>
        
        <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞ —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º -->
        <div class="col-lg-8 col-md-10 col-sm-12 pt-0"> <!-- –ò–∑–º–µ–Ω–µ–Ω—ã breakpoints -->
            <div class="floating-shapes">
                <div class="shape"></div>
                <div class="shape"></div>
                <div class="shape"></div>
            </div>

            <div class="book-widget mt-0">
                <div class="book-cover-container">
                    <img src="{{book.image.url}}" 
                         alt="–û–±–ª–æ–∂–∫–∞ –∫–Ω–∏–≥–∏" 
                         class="book-cover">
                </div>
                
                <div class="book-content">
                    <h1 class="book-title">{{book.name}}</h1>
                    <div class="book-author">–ê–≤—Ç–æ—Ä: {{book.author_name}}</div>
                    
                    <div class="book-meta">
                        <div class="meta-item">
                            <svg class="meta-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20a2 2 0 002 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>
                            </svg>
                            <span>–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞: {{book.reliz_year}}</span>
                        </div>
                        
                        <div class="meta-item">
                            <svg class="meta-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                            <span>–ñ–∞–Ω—Ä: {{book.category}}</span>
                        </div>
                    </div>

                    <div class="book-description">
                        <p>–û–ø–∏—Å–∞–Ω–∏–µ</p>
                        <p class="mt-3">{{book.description}}</p>
                    </div>

                    <div class="stats-container">
                        <div class="stat">
                             <form class="text-decoration:none;" action="{% url "book:read" book.slug %}" method="get">
                                <button class="like-btn" id="likeButton">
                                    <input type="text" name='like' style="text-decoration:none; display: none;" value="1", >
                                    <input type="text" name='page' style="text-decoration:none; display: none;" value="{{book.book_page}}", >
                                    <span>‚ù§Ô∏è</span>
                                    <span id="likeCount">{{book.likes}}</span> –ª–∞–π–∫–æ–≤                                
                                </button>
                            </form>
                        </div>
                        <div class="stat pages-count">
                            <span>üìñ</span>
                            <span>{{book.book_lists}} —Å—Ç—Ä–∞–Ω–∏—Ü—ã</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –ø—É—Å—Ç–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="col-lg-2 col-md-1 d-none d-lg-block"> <!-- –î–æ–±–∞–≤–ª–µ–Ω d-none d-lg-block -->
        </div>
    </div>
</div>

<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-lg-2 col-md-1 d-none d-lg-block">
        </div>
        
        <div class="col-lg-8 col-md-10 col-sm-12">
            <!-- –§–æ—Ä–º–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è –∫–Ω–∏–≥–∏ -->
            <div class="book-reader-container">
                
                <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
                <div class="reader-settings">
                    <button class="setting-btn" id="fontSizeDown">A-</button>
                    <button class="setting-btn active" id="fontSizeNormal">A</button>
                    <button class="setting-btn" id="fontSizeUp">A+</button>
                    
                    <button class="setting-btn" id="toggleTheme">
                        <span>üåô</span> –ù–æ—á–Ω–æ–π —Ä–µ–∂–∏–º
                    </button>
                    
                    <button class="setting-btn" id="bookmarkBtn">
                        <span>üîñ</span> –ó–∞–∫–ª–∞–¥–∫–∞
                    </button>
                </div>

                <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
                <div class="page-container">
                    <div class="book-page" id="bookPage">
                        <div class="page-header">
                            <div class="chapter-meta">
                                <span class="page-number">–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{book.book_page}}</span>
                            </div>
                        </div>
                        
                        <div class="page-content">
                            {% if book.book_content %}
                                <p>{{book.book_content|linebreaksbr}}</p>
                            {% else %} 
                                <div class="empty-state" id="emptyState">
                                    <div class="empty-content">
                                    <div class="empty-icon">üìö</div>
                                    <h3 class="empty-title">–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é —Ç–∞–∫–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–µ—Ç</h3>
                                    <p class="empty-description">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</p>
                                    </div>
                                </div>   
                            {% endif %}    
                        </div>
                        
                        <div class="page-footer">
                            <div class="reading-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0.26%"></div>
                                </div>
                                <span>–ü—Ä–æ—á–∏—Ç–∞–Ω–æ: {{book.book_read_percent}}%</span>
                            </div>
                        </div>
                    </div>
                </div>

                

                <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
                <div class="reader-controls">
                    {% if book.book_page > 1 %}        
                    <form class="search-form" action="{% url "book:read" book.slug %}" method="get">
                    <input type="text" name='page' style="text-decoration:none; display: none;" value="{{book.book_page|add:'-1'}}", >
                    <button class="control-btn" id="prevPage">
                        <span>‚Üê</span> –ü—Ä–µ–¥—ã–¥—É—â–∞—è
                    </button>
                    </form>
                    {% else %}
                    <button class="control-btn disable" id="prevPage" style="disable">
                        <span>‚Üê</span> –ü—Ä–µ–¥—ã–¥—É—â–∞—è
                    </button>
                    {% endif %}
                    
                    <div class="page-info">
                        <span class="current-page">{{book.book_page}}</span>
                        <span class="page-separator">/</span>
                        <span class="total-pages">{{book.book_lists}}</span>
                        <form class="search-form" action="{% url "book:read" book.slug %}" method="get">
                            <input class="form-control me-2 search-fields text-center" type="search"
                                placeholder="–ù–∞–π—Ç–∏" aria-label="Search" name="page" id="bookSearch">
                            <button type="submit" style="display: none;"></button> <!-- –°–∫—Ä—ã—Ç–∞—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ Enter -->
                        </form>
                    </div>
                    
                    {% if book.book_page < book.book_lists %}
                    <form class="search-form" action="{% url "book:read" book.slug %}" method="get">
                    <input type="text" name='page' style="text-decoration:none; display: none;" value="{{book.book_page|add:'1'}}", >
                    <button class="control-btn" id="nextPage">
                        –°–ª–µ–¥—É—é—â–∞—è <span>‚Üí</span>
                    </button>
                    </form>
                    {% else %}
                        <button class="control-btn disable" id="prevPage" style="disable">
                        –°–ª–µ–¥—É—é—â–∞—è
                        <span>‚Üê</span> 
                    </button>
                    {% endif %}
                </div>

            </div>
        </div>

        <div class="col-lg-2 col-md-1 d-none d-lg-block">
        </div>
    </div>
</div>
{% endblock %}

{% block script %}
    <script src="{% static "js\book\book_read.js" %}"></script>
    <script src="{% static "js\book\book_form.js" %}"></script>
{% endblock  %}